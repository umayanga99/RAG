<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- OneTrust Cookies Consent Notice start for broadcom.com -->
        <!-- <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="6a5fee8c-80be-4b9a-ab7e-b607e3f8ad3e-test" ></script> -->
        <script id="cookieScript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="6a5fee8c-80be-4b9a-ab7e-b607e3f8ad3e" ></script>
        <script type="text/javascript">
        function OptanonWrapper() { }
        </script>
        <!-- OneTrust Cookies Consent Notice end for broadcom.com -->

        <!-- OneTrust Cookies Settings button start -->
        <button id="ot-sdk-btn" class="ot-sdk-show-settings">Cookie Settings</button>
        <!-- OneTrust Cookies Settings button end -->     
        
        <!-- Google Tag Manager -->
        <script>
            (function (w, d, s, l, i) {
                  w[l] = w[l] || [];
                  w[l].push({
                    'gtm.start': new Date().getTime(),
                    event: 'gtm.js'
                  });
                  var f = d.getElementsByTagName(s)[0],
                    j = d.createElement(s),
                    dl = l != 'dataLayer' ? '&l=' + l : '';
                  j.async = true;
                  j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
                  f.parentNode.insertBefore(j, f);
            })(window, document, 'script', 'dataLayer', 'GTM-KF7XWD');

        </script>
        <!-- End Google Tag Manager -->
        <title>Troubleshooting ESX/ESXi virtual machine performance issues</title>
        <link rel="icon" type="image/x-icon" href="https://knowledge.broadcom.com/broadcom-log.png">
        <meta name="description" content="  ">
        <script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","name":"VMware vSphere ESXi","alternateName":"VMware vSphere ESXi","datePublished":"04-25-2025 13:57","dateModified":"04-25-2025 13:57","mainEntityOfPage":{"@type":"Webpage","URL":"https://knowledge.broadcom.com/external/article/304594"},"keywords":"N/A","url":"https://knowledge.broadcom.com/external/article/304594"},"author":"Broadcom Inc","headline":"Troubleshooting ESX/ESXi virtual machine performance issues","publisher":{"@type":"Organization","name":"Broadcom Inc","logo":{"@type":"ImageObject","url":""}},"aggregateRating":{"@type":"AggregateRating","ratingValue":"","ratingCount":""}}
        </script>
        <link rel="canonical" href="https://knowledge.broadcom.com/external/article/304594/troubleshooting-esxesxi-virtual-machine.html">

        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500" rel="stylesheet">

        <!--SU Scripts-->
        <script type="text/javascript" src="https://searchunify.broadcom.com/resources/Allow/an.js?uid=1fd47e1f-f7d9-11ea-beba-0242ac12000b" defer=""></script>
        <style>
            body {
                --wolken-primary-color: #CC092F;
                --wolken-primary-color-light: #CC092F0D;
                --wolken-primary-complimentory-color:  #2030CC;
                --wolken-accent-complimentory-color:  #CCBC20;
                background: #FFFFFF;
                height: 100vh;
                padding: 0;
                /* margin: 0; */
                font-size: 16px;
                margin: 12px !important;
            }

            #onetrust-consent-sdk{
             font-family: "Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";   
             font-family: "Gotham-Book",sans-serif;   
            }

            #ot-sdk-btn.ot-sdk-show-settings{
                display: none;
            }

            * {
                box-sizing: border-box;
            }

            h1,
            h2,
            h3,
            h4, 
            h5,
            h6 {
                margin: 12px 0;
            }

            h1{
                line-height: 28px;
            }

            h2{
                line-height: 24px;
            }
            /* newly added for INC01200689 */
            img {
                         height: auto !important;
                         max-width: 100% !important;
            }
            .wolken-h3 {
                font: 500 19px/32px Poppins;
            }

            .wolken-h4 {
                font: 400 15px/24px Poppins;
            }

            .wolken-h5 {
                font: 400 13px/20px Poppins;
            }

            .flex-column {
                display: flex;
                flex-direction: column;
            }

            .flex-row {
                display: flex;
                flex-direction: row;
            }

            .column-gap-16 > *:not(:last-child) {
                margin-bottom: 16px;
            }

            .row-gap-16 > *:not(:last-child) {
                margin-right: 16px;
            }

            .row-gap-8 > *:not(:last-child) {
                margin-right: 8px;
            }

            .row-gap{
                margin: 10px 15px;
            }

            .row-align-space-between-center {
                place-content: center space-between;
                align-items: center;
            }

            .row-align-center-center {
                place-content: center;
                align-items: center;
            }

            .custom-header, .custom-footer {
                max-height: 100%;
                width: 100%;
                display: block;
                border: 0;
            }

            .search-bar{
                border: 1px solid #cacaca;
                width: calc(100%);
                outline: none;
                padding: 12px 0;
                padding-left: 15px !important;
                text-indent: 12px;
                font-family: arial,sans-serif;
                font-size: 16px;
                line-height: 24px;
                height: 30px;
                white-space: pre;
                overflow: auto;
                box-sizing: border-box;
                display: block;
                border-radius: 6px;
            }

            .show_more, .show_less{
                    width: auto !important;
            }

            .search-button-container{
                padding: 0 16px;
                display: flex;
                align-items: center;
                /* place-content: end; */
                margin-bottom: 5px !important;
                place-content: center;
                margin-bottom: 5px !important;
                width: 100%;
                background: transparent linear-gradient(90deg, #3D4145 0%, #FAFAFA 100%) 0% 0% no-repeat padding-box !important;
                background-repeat: no-repeat;
            }

            .search-bar-container{
                width: 880px;
                display: flex;
                height: 100px;
                align-items: center;
            }

            .material-icon-search{
                cursor:pointer;
                align-self: center;
                font-size: 20px;
                color: #00000061;
            }

            .article-updated-time {
                flex: 0 0 auto;
                align-items: center;
            }

            .article-updated-date-icon {
                color: var(--wolken-accent-complimentory-color);
            }

            .article-updated-date-icon_cal{
                color: var(--wolken-primary-complimentory-color);
            }


            .article-detail-card {
                box-shadow: 0px 0px 6px #00000066;
                border-top: 4px solid var(--wolken-primary-color);
                border-radius: 10px;
                width: 100%;
            }

            .article-detail-card-header {
                padding: 8px 16px;
                border-bottom: 1px solid #00000066;
            }

            .article-detail-card-content {
                padding: 8px 16px;
                max-width: 100%;
                overflow: auto;
            }

            .like_dislike_btn {
                cursor: pointer;
            }

            .product-container {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                padding: 8px;
            }

            .product-chip {
                padding: 4px 12px;
                margin: 4px;
                background: var(--wolken-primary-color-light);
                border: 1px solid #00000066;
                border-radius: 50px;
                font: 400 12px/25px Poppins;
                color: #000000;
            }

            .attachment-container {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
            }

            .attachment-card {
                box-shadow: 0px 0px 2px #00000033;
                border-radius: 4px;
                margin: 8px;
            }

            .attachment-card:hover {
                box-shadow: 0px 0px 4px #00000033;
            }

            .attachment-name {
                padding: 0px 8px;
                font: 400 12px/18px Poppins;
            }

            .attachment-download {
                padding: 8px 12px;
                color: #ffffff;
                background: var(--wolken-primary-color);
                border-radius: 4px;
                height: 100%;
                cursor: pointer;
            }

            .attachment-download-icon {
                font-size: 16px;
                height: 16px;
                width: 16px;
            }

            .text-ellipsis {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .article-page {
                position: relative;
            }

            .loader-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                background-color: #ffffff;
                z-index: 1;
            }

            .article-container {
                display: none;
                position: absolute;
                top: 0;
                left: 0;
                z-index: 0;
                width: 100%;
            }

            .wolken-footer {
                width: 100%;
                height: 30px;
                padding: 0 16px;
                background-color: var(--wolken-primary-color-light);
                place-content: center flex-end;
                align-items: center;
            }

            .wolken-footer-content {
                text-decoration: none;
                cursor: pointer;
                font: 400 12px/10px Poppins;
            }

            table {
                table-layout: fixed;
                border: 1px solid;
                border-collapse: collapse;
                white-space: initial;
                word-break: break-word;
            }

            table td, table th {
                border: 1px solid;
                border-collapse: collapse;
                padding: 10px;
            }

            .alert_style{
                         background-color: rgb(209, 119, 119);
                         padding: 5px 5px 5px 5px;
                         border-radius: 5px 5px 5px 5px;
                    }
                    .kb_article_alert {
                         font-weight: bold; font-size: 15px;
                    }

            @media all and (min-width: 1200px) {
              .wolken-content-container {
                max-width: 1170px;
                width: 100%;
                margin: auto;
                padding: 16px 0px;
              }

              .article-header {
                display: flex;
                flex-direction: row;
                place-content: flex-start space-between;
                align-items: flex-start;
                margin-top: 10px !important;
              }

              .article-ruler{
                border: 2px solid var(--wolken-primary-color);
                    width: 10px;
                    width: 100%;
                    position: absolute;
                    top:135px;
                    left:0;
                    right:0;
              }

              .article-header > div:not(:last-child) {
                margin-right: 16px;
              }
              .article-header-info{
               display: flex;
                flex-direction: row;
                place-content: flex-start start;
                align-items: flex-start;
              }
              .article-header-info > div:not(:last-child) {
                margin-right: 16px;
              }
            }

            @media all and (min-width: 1440px) {
              .wolken-content-container {
                max-width: 1400px;
                margin: auto;
              }
            }

            @media all and (min-width: 1199px) {
              .wolken-content-container {
                max-width: 930px;
                margin: auto;
              }
            }

            @media all and (min-width: 992px) {
              .wolken-content-container {
                max-width: 960px;
                margin: auto;
              }
            }

            @media all and (max-width: 1199px){
                .wolken-content-container {
                    width: 100%;
                    padding: 16px;
                }

                .attachment {
                    width: 25%;
                }

                .article-header {
                    display: flex;
                    flex-direction: row;
                    place-content: flex-start space-between;
                    align-items: flex-start;
                  }

                  .article-header > div:not(:last-child) {
                    margin-right: 16px;
                  }
                .article-header-info{
                   display: flex;
                   flex-direction: row;
                   place-content: flex-start start;
                   align-items: flex-start;
                  }
                  .article-header-info > div:not(:last-child) {
                   margin-right: 16px;
                  }
            }

            @media all and (min-width: 768px) and (max-width: 959px) {
                .attachment {
                    width: 33.333333%;
                }

                .article-header {
                    display: flex;
                    flex-direction: column;
                  }

                  .article-header > div:not(:last-child) {
                    margin-bottom: 8px;
                  }
            }

            @media all and (max-width: 767px){
                .attachment {
                    width: 50%;
                }

                .article-header {
                    display: flex;
                    flex-direction: column;
                  }

                  .article-header > div:not(:last-child) {
                    margin-bottom: 8px;
                  }
                 .article-header-info{
                   display: flex;
                   flex-direction: row;
                   place-content: flex-start start;
                   align-items: flex-start;
                  }
                  .article-header-info > div:not(:last-child) {
                   margin-right: 16px;
                  }
            }

            .ghost-loader {
                border-radius: 5px;
                animation: shine-lines 1.5s infinite linear;
                background-image: linear-gradient(to right, rgba(211, 211, 211, 0.2) 0%, rgba(211, 211, 211, 0.7) 20%,
                    rgba(211, 211, 211, 0.9) 40%, rgba(211, 211, 211, 0.2) 100%) ;
            }

            @keyframes shine-lines {
                0% {
                    background-position: -100px;
                }

                40%, 100% {
                    background-position: 140px;
                }
            }

            .ghost-custom-header {
                width: 100%;
                height: 90px;
            }

            .ghost-article-title {
                width: 200px;
                height: 32px;
            }

            .ghost-article-date {
                width: 200px;
                height: 32px;
            }

            .ghost-article-detail-title {
                width: 150px;
                height: 24px;
            }

            .ghost-product-detail-content>div {
                width: 20%;
                height: 30px;
                padding: 4px 12px;
                margin: 4px;
                border-radius: 50px;
            }

            .ghost-article-detail-content>div:nth-child(1) {
                width: 70%;
                height: 20px
            }

            .ghost-article-detail-content>div:nth-child(2) {
                width: 20%;
                height: 30px
            }

            .ghost-article-detail-content>div:nth-child(3) {
                width: 40%;
                height: 20px
            }

            .ghost-article-detail-content>div:nth-child(4) {
                width: 30%;
                height: 15px
            }

            .ghost-article-detail-content>div:nth-child(5) {
                width: 50%;
                height: 25px
            }

            .ghost-custom-footer {
                width: 100%;
                height: 140px;
            }

            .wolken-primary-button {
                margin-left: 2px;
                /* background-color: var(--wolken-primary-color); */
                background-color: #005C8A;
                border-radius: 4px;
                box-shadow: 0 5px 6px 0rgba(0, 0, 0, 0.1);
                border: none;
                color: white;
                border: 1px solid #7e8c9a;
                border-left: none;
                text-decoration: none;
                text-align: center;
                vertical-align: middle;
                overflow: hidden;
                height: 30px;
                width: 65px;
                min-width: 65px;
                cursor: pointer;
                line-height: 0;
            }

            .wolken-primary-button .material-icons {
                font-size: 20px;
                height: 20px;
                width: 20px;
            }

            #feedback_actionMsg, #feedback_actions {
               margin: 8px 8px 8px 0px;
            }

            .icon-24{
              font-size: 20px;
            }

            span.mat-caption {
            font: 400 12px/14px Poppins;
            letter-spacing: normal;
            }

            @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
              /* IE10+ specific styles go here */
                    .article-updated-date-icon {
                        color: var(--wolken-primary-complimentory-color);
                        color: #ccbc20;
                    }

                    .article-updated-date-icon_cal{
                        color: var(--wolken-primary-complimentory-color);
                        color: #2030cc;
                    }

                    .article-detail-card {

                        box-shadow: 0px 0px 10px 0px rgba(68,68,68,0.6);
                        border-top: 4px solid var(--wolken-primary-color);
                        border-top-style: solid;
                        border-top-width: 4px;
                        border-top-color: rgb(204, 9, 47);
                        border-radius: 10px;
                        width: 100%;
                    }

                    .article-detail-card-header {
                        padding: 8px 16px;
                        border-bottom: 1px solid #00000066;
                        border-bottom-style: solid;
                        border-bottom-width: 1px;
                        border-bottom-color: rgba(0, 0, 0, 0.40);
                    }
                     .product-chip {
                        padding: 4px 12px;
                        margin: 4px;
                        background: var(--wolken-primary-color-light);
                        background: rgba(204, 9, 47, 0.05);
                        border: 1px solid rgba(0, 0, 0, 0.40);
                        border-style: solid;
                        border-width: 1px;
                        border-color: rgba(0, 0, 0, 0.40);
                        border-radius: 50px;
                        font: 400 12px/25px Poppins;
                        color: #000000;
                    }
                    .attachment-card {
                        box-shadow: 0px 0px 2px 0px rgba(68,68,68,0.6);
                        border-radius: 4px;
                        margin: 8px;
                    }

                    .attachment-card:hover {
                        box-shadow: 0px 0px 4px 0px rgba(68,68,68,0.6);

                    }

                    .attachment-name {
                        padding: 0px 8px;
                        font: 400 12px/18px Poppins;
                    }

                    .attachment-download {
                        padding: 8px 12px;
                        color: #ffffff;
                        background: var(--wolken-primary-color);
                        background: rgb(204, 9, 47);
                        border-radius: 4px;
                        height: 100%;
                        cursor: pointer;
                    }
                     .wolken-footer {
                        width: 100%;
                        height: 30px;
                        padding: 0 16px;
                        background-color: var(--wolken-primary-color-light);
                        background: rgba(204, 9, 47, 0.05);
                        place-content: center flex-end;
                        justify-content: flex-end;
                        align-items: center;
                    }
                    .wolken-primary-button {
                        box-shadow: 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);
                        background-color: var(--wolken-primary-color);
                        background-color: rgb(204, 9, 47);
                        color: #ffffff;
                        padding: 4px 12px;
                        font-size: 12px;
                        line-height: 24px;
                        cursor: pointer;
                        outline: 0;
                        border: none;
                        transform: translate3d(0,0,0);
                        transition: background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);
                        font-family: Poppins;
                        font-weight: 500;
                        border-radius: 4px;
                    }

                    table {
                        table-layout: fixed;
                        border: 1px solid;
                        border-collapse: collapse;
                        white-space: initial;
                        word-break: break-word;
                    }

                    table td, table th {
                        border: 1px solid;
                        border-collapse: collapse;
                    }



            }

            pre {
            white-space: pre-wrap !important;
            background: #f7f7f7 !important;
            padding: 5px !important;
            }

            hr {
              margin: 20px 0;
            }
            
            hr br[data-mce-bogus] {
              display: none;
            }
        </style>
    </head>
    <body>

        <div class="article-page">
            <div class="article-container flex-column">

                <iframe  id = "global-header" class="custom-header" title="https://cdn.wolkenservicedesk.com/Broadcom_%20Header.html" src="https://cdn.wolkenservicedesk.com/Broadcom_%20Header.html" height="90px" ></iframe>
                <div class="search-button-container">
                    <div class="search-bar-container">
                        <span class="material-icons material-icon-search" style="margin-left: 5px;position: absolute;">search</span>
                        <input type="text" placeholder="Search" name="search" class="search-bar" id="searchBox" onkeypress="redirectOnSearch(event)">
                        <span class="material-icons material-icon-search" style="margin-left: -25px;" onclick="clearSearch()">cancel</span>
                    </div>
                    <button onclick="redirectOnSearch()" class="wolken-primary-button">
                        <!-- <span class="material-icons">search</span> -->
                        Search
                    </button>
                </div>
                <div class="wolken-content-container flex-column column-gap-16">

                    <!-- <hr class="article-ruler"> -->
                    <div class="article-header">
                        <h3 class="wolken-h3">Troubleshooting ESX/ESXi virtual machine performance issues</h3>

                    </div>
                    <div class="article-header-info">
                        <div class="flex-row row-gap-8 article-updated-time">
                            <span class="material-icons article-updated-date-icon">book</span>
                            <h4 class="wolken-h4">Article ID: 304594</h4>
                        </div>
                        <div class="flex-row row-gap-8 article-updated-time">
                            <span class="material-icons article-updated-date-icon_cal">calendar_today</span>
                            <h4 class="wolken-h4">Updated On: <span id="date_time"></span></h4>
                        </div>
                    </div>
                    <div class="article-detail-card">
                        <div class="article-detail-card-header">
                            <h4 class="wolken-h4">Products</h4>
                        </div>
                        <div class="product-container wolken-h5">
                            
                                
                                 <span class="product-chip">VMware vSphere ESXi</span>
                                
                            
                        </div>
                        <button class="show_more flex-row row-align-center-center row-gap wolken-primary-button" onclick="showMoreItems()">Show More</button>
                        <button class="show_less flex-row row-align-center-center row-gap wolken-primary-button" onclick="showLessItems()">Show Less</button>
                    </div>

                    
                        <div class="article-detail-card">
                            <div class="article-detail-card-header">
                                <h4 class="wolken-h4">Issue/Introduction</h4>
                            </div>
                            <div class="article-detail-card-content wolken-h5">
                                <div>This article provides information on isolating a performance issue on ESXi/ESX.<br><br>Symptoms:<br>
<ul>
<li>Services running in guest virtual machines respond slowly.</li>
<li>Applications running in the guest virtual machines respond intermittently.</li>
<li>The guest virtual machine may seem slow or unresponsive.</li>
</ul></div>
                            </div>
                        </div>
                    

                    

                    
                        <div class="article-detail-card">
                            <div class="article-detail-card-header">
                                <h4 class="wolken-h4">Cause</h4>
                            </div>
                            <div class="article-detail-card-content wolken-h5">
                                <div>Performance issues may be caused by several different areas such as CPU constraints, memory overcommitment, storage latency, or network latency. If one or more of your virtual machines has a bad response time, consider each of these areas to find the bottleneck.</div>
                            </div>
                        </div>
                    



                    
                        <div class="article-detail-card">
                            <div class="article-detail-card-header">
                                <h4 class="wolken-h4">Resolution</h4>
                            </div>
                            <div class="article-detail-card-content wolken-h5">
                                <div><div>Each step below provides instructions and links to the appropriate documents. The steps are ordered in the most appropriate sequence to isolate the issue and to identify the proper resolution. They are also ordered in the most appropriate sequence to minimize data loss.</div>
<div>&nbsp;</div>
<div><strong>Note</strong>: After completing each step, determine whether the performance issue still exists. Work through each troubleshooting step in order, and do not skip a step.</div>
<p>This article includes four main sections:</p>
<ol>
<li>CPU Constraints&nbsp;</li>
<li>Memory Overcommitment</li>
<li>Storage Latency</li>
<li>Network Latency</li>
</ol>
<h3><a name="CPU"></a>CPU constraints<a name="CPU constraints"></a></h3>
<p>To determine whether the poor performance is due to a CPU constraint:</p>
<ol>
<li>Use the <code>esxtop</code> command to determine if the ESXi/ESX server is being overloaded. For more information about esxtop, see the <em>Resource Management Guide</em> for your version of ESXi/ESX:
<ul>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0.html" target="_blank" rel="noopener">ESXi 8.0</a></li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/7-0/vsphere-resource-management-7-0.html" target="_blank" rel="noopener">ESXi 7.0</a>&nbsp;</li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/6-7/vsphere-resource-management-6-7.html" target="_blank" rel="noopener">ESXi 6.7&nbsp;</a></li>
</ul>
<ol>
<li>Examine the <code>load average</code> on the first line of the command output.<br><br>A load average of 1.00 means that the ESXi/ESX Server machineâ€™s physical CPUs are fully utilized, and a load average of 0.5 means that they are half utilized. A load average of 2.00 means that the system as a whole is overloaded.<br>&nbsp;</li>
<li>Examine the <code>%READY</code> field for the percentage of time that the virtual machine was ready but could not be scheduled to run on a physical CPU.<br><br>Under normal operating conditions, this value should remain under 5%. If the ready time values are high on the virtual machines that experience bad performance, then check for CPU limiting:<br>&nbsp;
<ul>
<li>Make sure the virtual machine is not constrained by a CPU limit set on itself</li>
<li>Make sure that the virtual machine is not constrained by its resource pool.<br><br>For more information, see <a href="https://knowledge.broadcom.com/external/article/326270/impact-of-virtual-machine-memory-and-cpu.html" target="blank">Impact of virtual machine memory and CPU resource limits</a>.<br>&nbsp;</li>
</ul>
</li>
</ol>
If the load average is too high, and the ready time is not caused by CPU limiting, adjust the CPU load on the host. To adjust the CPU load on the host, either:<br>&nbsp;
<ul>
<li>Increase the number of physical CPUs on the host<br><br>OR<br>&nbsp;</li>
<li>Decrease the number of virtual CPUs allocated to the host. To decrease the number of virtual CPUs allocated to the host, either:<br>&nbsp;
<ul>
<li>Reduce the total number of CPUs allocated to all of the virtual machines running on the ESX host. For more information, see <a href="https://knowledge.broadcom.com/external/article/326296/determining-if-multiple-virtual-cpus-are.html" target="blank">Determining if multiple virtual CPUs are causing performance issues</a>.<br><br>OR<br>&nbsp;</li>
<li>Reduce the number of virtual machines running on the host.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3><a id="Memory" name="Memory"></a> Memory overcommitment</h3>
<p>To determine whether the poor performance is due to memory overcommitment:</p>
<ol>
<li>Use the <code>esxtop</code> command to determine whether the ESXi/ESX server's memory is overcommitted. For more information about esxtop, see the <em>Resource Management Guide</em> for your version of ESXi/ESX:
<ul>
<li style="list-style-type: none;">
<ul>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0.html" target="blank" rel="noopener">ESXi 8.0</a></li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/7-0/vsphere-resource-management-7-0.html" target="blank" rel="noopener">ESXi 7.0</a>&nbsp;</li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/6-7/vsphere-resource-management-6-7.html" target="blank" rel="noopener">ESXi 6.7&nbsp;</a></li>
</ul>
</li>
</ul>
<ol>
<li>Examine the <code>MEM overcommit avg</code> on the first line of the command output. This value reflects the ratio of the requested memory to the available memory, minus 1.<br><br><strong>Examples</strong>:<br>&nbsp;
<ul>
<li>If the virtual machines require 4 GB of RAM, and the host has 4 GB of RAM, then there is a 1:1 ratio. After subtracting 1 (from 1/1), the <code>MEM overcommit avg</code> field reads 0. There is no overcommitment and no extra RAM is required.</li>
<li>If the virtual machines require 6 GB of RAM, and the host has 4 GB of RAM, then there is a 1.5:1 ratio. After subtracting 1 (from 1.5/1), the <code>MEM overcommit avg</code> field reads 0.5. The RAM is overcommitted by 50%, meaning that 50% more than the available RAM is required.<br>&nbsp;</li>
</ul>
</li>
</ol>
If the memory is being overcommitted, adjust the memory load on the host. To adjust the memory load, either:<br>&nbsp;
<ul>
<li>Increase the amount of physical RAM on the host<br><br>OR<br>&nbsp;</li>
<li>Decrease the amount of RAM allocated to the virtual machines. To decrease the amount of allocated RAM, either:<br>&nbsp;
<ul>
<li>
<div>Decrease the total amount of RAM allocated to all of the virtual machines on the host<br><br>OR<br>&nbsp;</div>
</li>
<li>Reduce the total number of virtual machines on the host.<br>&nbsp;</li>
</ul>
</li>
</ul>
</li>
<li>Determine whether the virtual machines are ballooning and/or swapping.<br><br>To detect any ballooning or swapping:<br>&nbsp;
<ol>
<li>Run <code>esxtop</code>.</li>
<li>Type <span style="font-weight: bold;">m</span> for memory</li>
<li>Type <span style="font-weight: bold;">f</span> for fields</li>
<li>Select the letter <span style="font-weight: bold;">J</span> for Memory Ballooning Statistics (MCTL)</li>
<li>Look at the <code>MCTLSZ</code> value.<br><br><code>MCTLSZ (MB)</code> displays the amount of guest physical memory reclaimed by the balloon driver.<br>&nbsp;</li>
<li>Type <strong>f</strong> for Field</li>
<li>Select the letter for Memory Swap Statistics (SWAP STATS).</li>
<li>Look at the <code>SWCUR</code> value.<br><br><code>SWCUR (MB)</code> displays the current Swap Usage.<br>&nbsp;</li>
</ol>
To resolve this issue, ensure that the ballooning and/or swapping is not caused by the memory limit being incorrectly set. If the memory limit is incorrectly set, reset it correctly. For more information, see:<br>&nbsp;
<ul>
<li style="list-style-type: none;">
<ul>
<li><a href="https://knowledge.broadcom.com/external/article/326270/impact-of-virtual-machine-memory-and-cpu.html" target="blank">Impact of virtual machine memory and CPU resource limits</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3><a id="Storage" name="Storage"></a> Storage Latency</h3>
<p>To determine whether the poor performance is due to storage latency:</p>
<ol>
<li>Determine whether the problem is with the local storage. Migrate the virtual machines to a different storage location.</li>
<li>Reduce the number of Virtual Machines per LUN.</li>
<li>Look for log entries in the Windows guests that look like this:<br><br><code>The device, \Device\ScsiPort0, did not respond within the timeout period.</code><br>&nbsp;</li>
<li>Using <code>esxtop</code>, look for a high DAVG latency time. For more information, see <a href="https://knowledge.broadcom.com/external/article?legacyId=1008205" target="blank">Using esxtop to identify storage performance issues for ESXi (multiple versions)</a>.</li>
<li>Determine the maximum I/O throughput you can get with the <code>iometer</code> command. For more information, see <a href="https://knowledge.broadcom.com/external/article?legacyId=1006821" target="blank">Testing virtual machine storage I/O performance for ESXi</a></li>
<li>Compare the <code>iometer</code> results for a VM to the results for a physical machine attached to the same storage.</li>
<li>Check for SCSI reservation conflicts. For more information.</li>
<li>If you are using iSCSI storage and jumbo frames, ensure that everything is properly configured. For more information, see:<br>&nbsp;
<ul>
<li><a href="https://knowledge.broadcom.com/external/article?legacyId=1007654" target="blank">iSCSI and Jumbo Frames configuration on VMware ESXi/ESX</a></li>
<li><a href="https://knowledge.broadcom.com/external/article?legacyId=1038827" target="blank">Enabling Jumbo Frames on virtual switches</a><br>&nbsp;</li>
</ul>
</li>
<li>If you are using iSCSI storage and multipathing with the iSCSI software initiator, ensure that everything is properly configured. For more information, see these sections of the iSCSI SAN Configuration Guide:<br>&nbsp;
<ul>
<li>
<div><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/configuring-software-iscsi-adapters-in-the-vmware-host-client.html" target="_blank" rel="noopener">Configuring Software iSCSI Adapters in the VMware Host Client</a></div>
<h1 id="GUID-4D0E250E-4F8C-4F86-81C1-EC9D317CE02E-en_GUID-9EC85880-A622-41FC-8616-8399C4987A82" class="title" style="box-sizing: inherit; margin: 0px; font-weight: 300; line-height: 25px; font-size: 2.5rem; scroll-margin-top: 147px; color: #1e1e1e; font-family: ArialMT, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;" tabindex="0"></h1>
</li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/7-0/vsphere-storage-7-0/configuring-iscsi-and-iser-adapters-and-storage-with-esxi/setting-up-network-for-iscsi-and-iser-with-esxi/configure-port-binding-for-iscsi-and-iser-on-esxi.html" target="_blank" rel="noopener">Configure Port Binding for iSCSI or iSER</a></li>
</ul>
</li>
</ol>
<div>If you identify a storage-related issue:</div>
<ol>
<li>Ensure that your hardware array and your HBA cards are certified for ESX/ESXi. For more information, see the VMware <a href="https://compatibilityguide.broadcom.com/" target="_blank" rel="noopener">Hardware Compatibility List</a>.&nbsp;</li>
<li>Ensure that the BIOS of your physical server is up to date. For more information, see <a href="https://knowledge.broadcom.com/external/article?legacyId=1037257" target="blank">Checking your firmware and BIOS levels to ensure compatibility with ESX/ESXi</a>.</li>
<li>Ensure that the firmware of your HBA is up to date.</li>
<li>Ensure that the ESXi can recognize the correct mode and path policy for your SATP Storage array type and PSP Path Selection Policy. For more information, see <a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-storage-8-0/understanding-multipathing-and-failover-in-the-esxi-environment/viewing-and-managing-storage-paths-on-esxi-hosts.html#:~:text=View%20Storage%20Device%20Paths&amp;text=Select%20the%20storage%20device%20whose%20paths%20you%20want%20to%20view.&amp;text=tab%20and%20review%20the%20module,Policy%20assigned%20to%20the%20device." target="_blank" rel="noopener">Viewing and Managing Storage Paths on ESXi Hosts</a>.&nbsp;</li>
</ol>
<h3><a id="Network" name="Network"></a> Network latency</h3>
<p>Network performance can be highly affected by CPU performance. Rule out a CPU performance issue before investigating network latency.</p>
<p>To determine whether the poor performance is due to network latency:</p>
<ol>
<li>Test the maximum bandwidth from the virtual machine with the Iperf tool. This tool is available from <a href="https://iperf.fr/iperf-download.php#windows" target="_blank" rel="noopener">https://github.com/esnet/iperf</a><br><br><strong>Note</strong>: VMware does not endorse or recommend any particular third-party utility.<br>&nbsp;
<ol>
<li>While using Iperf, change the TCP windows size to 64 K. Performance also depends also on this value. To change the TCP windows size:<br>&nbsp;
<ol>
<li>On the server side, enter this command:<br><br><code>iperf -s</code><br>&nbsp;</li>
<li>On the client side, enter this command:<br><br><code>iperf.exe -c sqlsed -P 1 -i 1 -p 5001 -w 64K -f m -t 10 900M</code></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>&nbsp;</p>
<ol>
<li>Run Iperf with a machine outside the ESXi/ESX host. Compare the results with what you expect you should have, depending on your physical environment.</li>
<li>Run Iperf with another machine outside the ESXi/ESX host on the same VLAN on the same physical switch. If the performance is good, and the issue can only be reproduced with a machine at another geographical location, then the issue is related to your network environment.</li>
<li>Run Iperf between 2 VMs on the same ESX server/portgroup/vswitch. If the result is good, you can exclude a CPU, memory or storage issue.</li>
</ol>
<div>If you identify a bottleneck on the network:</div>
<ol>
<li>Work through the steps in <a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-monitoring-and-performance-8-0.html" target="_blank" rel="noopener">Solutions for Poor Network Performance</a>.</li>
<li>If you are using iSCSI storage and jumbo frames, ensure that everything is properly configured. For more information, see:<br>&nbsp;
<ul>
<li><a href="https://knowledge.broadcom.com/external/article?legacyId=1007654" target="blank">iSCSI and Jumbo Frames configuration on VMware ESXi/ESX</a></li>
<li><a href="https://knowledge.broadcom.com/external/article?legacyId=1038827" target="blank">Enabling Jumbo Frames on virtual switches</a>&nbsp;</li>
</ul>
</li>
<li>If you are using Network I/O Control, ensure that the shares and limits are properly configured for your traffic. For more information, see <a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-networking-8-0/network-io-control.html" target="_blank" rel="noopener">vSphere Network I/O Control</a>.</li>
<li>Ensure that traffic shaping is correctly configured. For more information, see <a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-networking-8-0/networking-policies/traffic-shaping-policy.html" target="_blank" rel="noopener">What is Traffic Shaping Policy.</a></li>
</ol>
<p>&nbsp;</p></div>
                            </div>
                        </div>
                    

                    
                        <div class="article-detail-card">
                            <div class="article-detail-card-header">
                                <h4 class="wolken-h4">Additional Information</h4>
                            </div>
                            <div class="article-detail-card-content wolken-h5">
                                <div><p><a href="https://knowledge.broadcom.com/external/article?legacyId=81931" target="blank">VMware Skyline Health Diagnostics for vSphere - FAQ</a><br>See these resources for more information on the topics discussed:</p>
<h3>CPU</h3>
<ul>
<li>The <em>ESX CPU Considerations</em> section of Performance Best Practices for VMware vSphere:
<ul>
<li>
<ul>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0.html" target="blank" rel="noopener">ESXi 8.0</a></li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/7-0/vsphere-resource-management-7-0.html" target="blank" rel="noopener">ESXi 7.0</a>&nbsp;</li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/6-7/vsphere-resource-management-6-7.html" target="blank" rel="noopener">ESXi 6.7&nbsp;</a><br><br></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://www.virten.net/vmware/esxtop/" target="_blank" rel="noopener">esxtop Guide</a></li>
</ul>
<h3>Memory</h3>
<ul>
<li>The <em>ESX Memory Considerations</em> section of Performance Best Practices for VMware vSphere:
<ul>
<li><a title="vSphere 8.0" href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-monitoring-and-performance-8-0.html" target="_blank" rel="noopener">vSphere 8.0</a></li>
<li><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/7-0/vsphere-monitoring-and-performance-7-0.html" target="_blank" rel="noopener">vSphere 7.0</a></li>
<li><a title="ESXi 6.7" href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/6-7/vsphere-monitoring-and-performance-6-7.html" target="_blank" rel="noopener">ESXi 6.7</a><br>&nbsp;</li>
</ul>
</li>
<li><a href="https://www.virten.net/vmware/esxtop/" target="_blank" rel="noopener">esxtop Guide</a></li>
</ul>
<h3>Storage</h3>
<ul>
<li><a href="https://knowledge.broadcom.com/external/article?legacyId=1267" target="blank">Changing the queue depth for QLogic, Emulex, and Brocade HBAs</a></li>
<li><a href="https://knowledge.broadcom.com/external/article?legacyId=1003469" target="blank">Tuning ESXi for better storage performance by modifying the maximum I/O block size</a></li>
<li><a href="https://blogs.vmware.com/vsphere/2012/05/troubleshooting-storage-performance-in-vsphere-part-1-the-basics.html" target="_blank" rel="noopener">Troubleshooting Storage Performance in vSphere</a></li>
</ul>
<p>&nbsp;</p>
<p>For any performance-related issues, it is always recommended to check the output of the command esxtop real time and we can also run esxtop command in the batch mode&nbsp;</p>
<p><a href="https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/7-0/vsphere-monitoring-and-performance-7-0/performance-monitoring-utilities-resxtop-and-esxtop.html" target="_blank" rel="noopener">Performance Monitoring Utilities: resxtop and esxtop</a></p>
<p>If all the above pointers are checked</p>
<p>Then additionally kindly check the events on the OS level</p>
<p>Run task manager or top command and check which process is utilizing more resources on the OS level.</p>
<p>&nbsp;</p>
<p><strong>Performance issues on a VM residing on any esxi host can be due to various reasons as mentioned below</strong></p>
<p>1. Due to the high IOPs generated on the OS layer.</p>
<p>2. Due to the misconfiguration of the numbers of CPU and Cores per socket</p>
<p>3. Overprovisioning on the ESXI hosts</p>
<p>4. Need to check on the values of RDY, CSTP, DAVG, KAVG, GAVG, CMDS/s, READS/s, WRITES/s, LAT/rd, LAT/wr, load average</p>
<p>5. Application-level issues may also cause performance-related issues on the VMs.</p>
<p>6. Check if the issue is happening intermittently or if it is continuous.&nbsp; We also need to check the pattern of the issue to determine the cause of the issue.</p>
<p>7. VM Backups may also create an issue and create performance issues.</p>
<p>8. Check if the VMs are running on a snapshot for a long time.</p>
<p>9. Check for any storage or network-related issues.</p>
<p>10.Investigate if there is any security scan triggered. It has been found on many cases that running of a security scan can cause CPU/Memory spikes and give performance issues.&nbsp;</p>
<p>Kindly reference this below article for <code>esxtop</code> and its values&nbsp;</p>
<p><a href="https://www.virten.net/vmware/esxtop/" target="_blank" rel="noopener">ESXTOP Guide</a></p>
<div>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div></div>
                            </div>
                        </div>
                    
                    
                    

                    <div class="feedback-section">
                        <h4 class="wolken-h3">Feedback</h4>
                        <div class="wolken-h4" id="feedback_actionMsg"></div>
                        <div class="wolken-h5">
                             <div id="feedback_actions" class="flex-row row-gap-16">
                                <div class="flex-row row-align-center-center row-gap-8 like_dislike_btn" onclick="onArticleLike()">
                                    <span class="material-icons">thumb_up</span>
                                    <span>Yes</span>
                                 </div>
                                 <div class="flex-row row-align-center-center row-gap-8 like_dislike_btn" onclick="onArticleDislike()">
                                    <span class="material-icons">thumb_down</span>
                                    <span>No</span>
                                 </div>
                             </div>
                        </div>
                    </div>

                </div>
                <div class="flex-row wolken-footer">
                    <span class="mat-caption">Powered by</span>
                      <a  target="_blank" href="https://www.wolkensoftware.com/">
                <img src="https://cdn.wolkenservicedesk.com/wolken-footer-image.png" alt="Wolken Software">
                    </a>
                </div>
                <iframe class="custom-footer" frameborder="0" scrolling="no" title="https://cdn.wolkenservicedesk.com/Broadcom_%20Footer.html" src="https://cdn.wolkenservicedesk.com/Broadcom_%20Footer.html" height="118px"></iframe>
            </div>

            <div class="loader-container flex-column">
                <div class="ghost-loader ghost-custom-header"></div>
                <div class="wolken-content-container flex-column column-gap-16">
                    <div class="flex-row row-gap-16 row-align-space-between-center">
                        <div class="ghost-loader ghost-article-title"></div>
                        <div class="ghost-loader ghost-article-date"></div>
                    </div>
                    <div class="article-detail-card">
                        <div class="article-detail-card-header">
                            <div class="ghost-loader ghost-article-detail-title"></div>
                        </div>
                        <div class="article-detail-card-content">
                            <div class="ghost-product-detail-content flex-row row-gap-16">
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                            </div>
                        </div>
                    </div>
                    <div class="article-detail-card">
                        <div class="article-detail-card-header">
                            <div class="ghost-loader ghost-article-detail-title"></div>
                        </div>
                        <div class="article-detail-card-content">
                            <div class="ghost-article-detail-content column-gap-16">
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                            </div>
                        </div>
                    </div>
                    <div class="article-detail-card">
                        <div class="article-detail-card-header">
                            <div class="ghost-loader ghost-article-detail-title"></div>
                        </div>
                        <div class="article-detail-card-content">
                            <div class="ghost-article-detail-content column-gap-16">
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                            </div>
                        </div>
                    </div>
                    <div class="article-detail-card">
                        <div class="article-detail-card-header">
                            <div class="ghost-loader ghost-article-detail-title"></div>
                        </div>
                        <div class="article-detail-card-content">
                            <div class="ghost-article-detail-content column-gap-16">
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                            </div>
                        </div>
                    </div>
                    <div class="article-detail-card">
                        <div class="article-detail-card-header">
                            <div class="ghost-loader ghost-article-detail-title"></div>
                        </div>
                        <div class="article-detail-card-content">
                            <div class="ghost-article-detail-content column-gap-16">
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                                <div class="ghost-loader"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ghost-loader ghost-custom-footer"></div>
            </div>
        </div>
    </body>
    <script>

        var apiDomain =  'https://api-broadcomcms-software.wolkenservicedesk.com/';
        var redirectOnSearchUrl =  'https://support.broadcom.com/web/ecx/search';
        var uiDomain =  '';
        var articleId = '304594';
       var articleTitle = 'Troubleshooting ESX/ESXi virtual machine performance issues';
        var articlePageUrl = uiDomain+'/wolken-support/article?articleId=';
        var attachmentVos = '';
        var kb_public_page_domain = 'broadcomcms-software.wolkenservicedesk.com'
        var kbDownloadDomain = 'broadcomcms-software.wolkenservicedesk.com';
        var regularAttachment = false



        var feedbackConfigData = {};

        document.getElementById('global-header').addEventListener('load', frameVisibilty);
        setTimeout(function ()  {
            document.getElementById('global-header').removeEventListener('load', frameVisibilty);
            frameVisibilty();
        }, 5000);

        function frameVisibilty() {
              setTimeout(function(){
                  document.getElementsByClassName('article-container')[0].style.display = 'flex';
                  document.getElementsByClassName('loader-container')[0].style.display = 'none';
              }, 1000);

            var date = document.getElementById('date_time');
            var d = '04-25-2025 13:57';
            date.innerHTML = d;
            date.innerHTML = d.split(' ')[0];

            var arr = document.getElementsByClassName("product-chip");
             if(arr.length > 15){
             document.getElementsByClassName('product-container')[0].style.overflow = 'hidden';
             document.getElementsByClassName('product-container')[0].style.height = '53px';
             document.getElementsByClassName('show_more')[0].style.display = 'block';
             document.getElementsByClassName('show_less')[0].style.display = 'none';
             }
             else{
             document.getElementsByClassName('product-container')[0].style.overflow = 'auto';
             document.getElementsByClassName('product-container')[0].style.height = 'auto';
             document.getElementsByClassName('show_more')[0].style.display = 'none';
             document.getElementsByClassName('show_less')[0].style.display = 'none';
             }
        }

          function showMoreItems(){
            document.getElementsByClassName('product-container')[0].style.overflow = 'auto';
            document.getElementsByClassName('product-container')[0].style.height = 'auto';
            document.getElementsByClassName('show_more')[0].style.display = 'none';
            document.getElementsByClassName('show_less')[0].style.display = 'block';
        }

        function showLessItems(){
            document.getElementsByClassName('product-container')[0].style.overflow = 'hidden';
            document.getElementsByClassName('product-container')[0].style.height = '53px';
            document.getElementsByClassName('show_more')[0].style.display = 'block';
            document.getElementsByClassName('show_less')[0].style.display = 'none';
        }

        function downloadAttachment(uniquefileid) {
            // var uniqueFileId = element.getAttribute('data-uniquefileid');
            //var uniqueFileId = element.dataset.uniquefileid;
            var uniqueFileId = uniquefileid;

            var form = document.createElement('form');
            form.setAttribute('method', 'post');
            form.setAttribute('action', apiDomain + 'es/attachments/download_attachment?domain='+kbDownloadDomain);
            form.setAttribute('target', '_self');
            var hiddenField = document.createElement('input');
            hiddenField.setAttribute('type', 'hidden');
            hiddenField.setAttribute('name', 'data');
            hiddenField.setAttribute('value', JSON.stringify({
                uniqueFileId: uniqueFileId
            }));
            form.appendChild(hiddenField);
            document.body.appendChild(form);
            window.open('', '_self');
            form.submit();
            form.parentNode.removeChild(form);
        }

        document.addEventListener('DOMContentLoaded', function(){
            articleViewed();
            getFeedbackConfig();
            saveArticleViewCountHistory();
        });

        function articleViewed() {
            try {

                        gza("conversion", {
                        index:"server_ws_knowledge_article" ,
                        type: 'ws_knowledge_articles_doc',
                        id: articleId,
                        rank: 1,
                        convUrl: location.href,
                        convSub: articleTitle
                    });
                } catch(error) {
                    console.log(error);
                }

            saveArticleCount('views');
        }

    function getFeedbackConfig() {
        if (kb_public_page_domain) {
        var articleFeedbackConfigRequest = new XMLHttpRequest();
        articleFeedbackConfigRequest.open('GET', apiDomain + 'es/nau/feedback/config');
            articleFeedbackConfigRequest.setRequestHeader("domain", kb_public_page_domain);
        articleFeedbackConfigRequest.send();
        articleFeedbackConfigRequest.onload = function () {
            if (articleFeedbackConfigRequest.status == 200) {
                var response = JSON.parse(articleFeedbackConfigRequest.response);
                if (response && response.data && response.data.feedbackConfigData) {
                    feedbackConfigData = response.data.feedbackConfigData;
                    document.getElementById('feedback_actionMsg').innerHTML = feedbackConfigData.actionMsg;
                } else {
                    document.getElementsByClassName('feedback-section')[0].remove();
                }
            }
        };
    } else {
        console.log('Error! KB public domain is not configrued.');
    }
    }

        function saveArticleCount(countType) {
            var data = {
                articleId: articleId
            };

            data[countType] = 1;

            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

        if (kb_public_page_domain) {
        var articleLikeRequest = new XMLHttpRequest();
        articleLikeRequest.open('POST', apiDomain + 'es/nau/feedback/feedback_count');
            articleLikeRequest.setRequestHeader("domain", kb_public_page_domain);
        articleLikeRequest.send(formData);
        articleLikeRequest.onload = function () {
            if (articleLikeRequest.status == 200) {
            }
        };
    } else {
        console.log('Error! KB public domain is not configrued.');
    }
    }

        function saveArticleViewCountHistory() {
            let articleViewData = new FormData();
            articleViewData.append('data', JSON.stringify({
                "articleId":articleId,
                "countType":"VIEWS"
            }));

        if (kb_public_page_domain) {
        var articleViewRequest = new XMLHttpRequest();
        articleViewRequest.open('POST', apiDomain + 'es/nau/count/save_article_count');
            articleViewRequest.setRequestHeader("domain", kb_public_page_domain);
        //articleViewRequest.withCredentials = true;
        articleViewRequest.send(articleViewData);
        articleViewRequest.onload = function () {
            if (articleViewRequest.status == 200) {
                console.log(articleViewRequest.response);
            }
        };
    } else {
        console.log('Error! KB public domain is not configrued.');
    }
    }

        function onArticleLike() {
            try {
                gza("pageRating", {
                    referer: document.referrer,
                    url: window.location.href,
                    t: document.getElementsByTagName('title')[0] ? document.getElementsByTagName('title')[0].innerText : window.location.href,
                    uid: '1fd47e1f-f7d9-11ea-beba-0242ac12000b',
                    feedback: 1
                });
            } catch(error) {
                console.log(error);
            }


            document.getElementById('feedback_actionMsg').innerHTML = feedbackConfigData.yesMsg;
            document.getElementById('feedback_actions').remove();

            saveArticleCount('likes');
        }

        function onArticleDislike() {
            saveArticleDisLikeCount();
             document.getElementById('feedback_actionMsg').innerHTML = feedbackConfigData.yesMsg;
             document.getElementById('feedback_actions').remove();
        }

        function redirectToFeedbackPage() {
            window.open(articlePageUrl + articleId +'&action=feedback', '_self');
        }

        function saveArticleDisLikeCount() {
            try {
                gza("pageRating", {
                    referer: document.referrer,
                    url: window.location.href,
                    t: document.getElementsByTagName('title')[0] ? document.getElementsByTagName('title')[0].innerText : window.location.href,
                    uid: '1fd47e1f-f7d9-11ea-beba-0242ac12000b',
                    feedback: 0
                });
            } catch(error) {
                console.log(error);
            }

            saveArticleCount('dislikes');
        }

        function clearSearch(){
            document.getElementById('searchBox').value = '';
        }

        function redirectOnSearch(e){
        if(e && e.keyCode === 13 || e === undefined){
        const searchText = document.getElementById('searchBox').value;
        var redirectOnSearchUrl = 'https://support.broadcom.com/web/ecx/search?searchString=' + searchText;
        window.open(redirectOnSearchUrl, '_blank');
      }
        }
    </script>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe title="No Script" src="https://www.googletagmanager.com/ns.html?id=GTM-KF7XWD" height="0" width="0"
        style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
</html>
